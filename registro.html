<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro</title>
  <link rel="stylesheet" href="css/estilo_registro.css">
</head>
<body>
  <div class="container">
    <h1 class="titulo">Únete</h1>

    <div class="hoja">
      <!-- Botón volver -->
      <a href="login.html" class="btn-volver">⬅ Volver</a>

      <h2>Crear una cuenta</h2>
      <hr>
      <form id="formRegistro">
        <label for="username">Nombre de usuario:</label>
        <input type="text" name="username" id="username" required>

        <label for="email">Correo electrónico:</label>
        <input type="email" name="email" id="email" required>

        <label for="contraseña">Contraseña:</label>
        <input type="password" name="contraseña" id="contraseña" required>

        <button type="submit" class="btn btn-registrar">Registrarse</button>
      </form>
    </div>
  </div>
<div id="overlay-fondo"></div>

  <!-- Modal de éxito -->
  <div id="registro-exitoso-modal">
    <h2>¡Registro Exitoso!</h2>
    <hr>
    <p>Bienvenido a <strong>Palabratro</strong><br>
    <b>¡Ya podés empezar a jugar!</b></p>
    <a href="index.php" class="btn-continuar">Continuar</a>
  </div>

 <script>
  const form = document.getElementById("formRegistro");
  const modal = document.getElementById("registro-exitoso-modal");
  const overlay = document.getElementById("overlay-fondo");
  const btnContinuar = document.getElementById("btn-continuar");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    try {
      const res = await fetch("registro.php", {
        method: "POST",
        body: formData
      });

      const text = await res.text();
      console.log("Respuesta bruta del servidor:", text);

      let data;
      try {
        data = JSON.parse(text);
      } catch (err) {
        throw new Error("Respuesta no es JSON válido");
      }

      if (data.ok) {
        // Muestra el modal y el fondo oscuro
        modal.classList.add("show");
        overlay.classList.add("show");
      } else {
        alert("⚠️ " + data.error);
      }
    } catch (err) {
      console.error(err);
      alert("❌ Error de conexión con el servidor o formato inválido.");
    }
  });

  btnContinuar.addEventListener("click", () => {
    // Oculta modal + overlay antes de redirigir
    modal.classList.remove("show");
    overlay.classList.remove("show");
    window.location.href = "index.php";
  });
</script>

</body>
</html>
